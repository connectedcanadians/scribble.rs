(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{applyDrawData:()=>Q,clear:()=>Z,drawLine:()=>et,fill:()=>tt});var n=document.getElementById("player-container"),o=document.getElementById("word-container"),r=document.getElementById("rounds"),a=document.getElementById("time-left"),i=document.getElementById("drawing-board"),c=document.getElementById("start-dialog"),l=document.getElementById("start-dialog-waiting"),s=document.getElementById("start-game-button"),d=document.getElementById("word-dialog"),u=document.getElementById("word-button-zero"),f=document.getElementById("word-button-one"),g=document.getElementById("word-button-two"),y=document.getElementById("score-dialog"),m=function(){return window.baseWidth/i.clientWidth},p=function(){return i.clientWidth/window.baseWidth},h=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.map((function(t){return t*p()}))},v=(document.getElementById("message-container"),document.getElementById("message-input")),w=document.getElementById("message-form"),b=document.getElementById("color-picker"),k=document.getElementById("center-dialog"),I=(document.getElementById("chat"),document.getElementById("erase-tool")),S=document.getElementById("clear-tool"),D=document.getElementById("draw-tool"),E=document.getElementById("fill-tool"),O=document.getElementById("undo-tool"),C=document.getElementById("small-circle"),T=document.getElementById("medium-circle"),B=document.getElementById("huge-circle"),j=function(t){C.className=0==t?"active":"",T.className=1==t?"active":"",B.className=2==t?"active":""},x=function(t){D.className=0==t?"draw active":"draw",I.className=1==t?"erase active":"erase",E.className=2==t?"fill active":"fill"};function H(t){A(),k.style.display="block",t.style.display="block"}var A=function(){k.style.display="none",c.style.display="none",l.style.display="none",d.style.display="none",y.style.display="none"};function L(t,e){n.innerHTML="",Object.keys(t).forEach((function(o){var r=t[o];if(r.connected){r.state;var a='<div class="playerBox"> <img src="../resources/image/avatar_phillip.png" alt=""><div class="name';a+='">'+r.name+"</div>",r.id!==e&&(a+='<button class="kick-button" id="kick-button" type="button" title="Vote to kick this player" alt="Vote to kick this player" onclick="onClickKickButton('+r.id+')">üëã</button>'),a+='<span class="score">'+r.score+"</span></div>",1===r.state?a+="<span>‚úèÔ∏è</span>":2===r.state&&(a+="<span>‚úîÔ∏è</span>"),a+="</div></div></div>";var i=document.createRange().createContextualFragment(a);console.log(i),n.appendChild(i)}}))}function W(t,e){r.innerText="Round "+t+" of "+e}function X(t){o.innerHTML="",t.forEach((function(t){if(0===t.character)o.innerHTML+='<span class="guess-letter guess-letter-underline">&nbsp;</span>';else{var e=String.fromCharCode(t.character);t.underline?o.innerHTML+='<span class="guess-letter guess-letter-underline">'+e+"</span>":o.innerHTML+='<span class="guess-letter">'+e+"</span>"}}))}function M(t,e,n){console.log("message",e,n)}function P(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function F(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?P(Object(n),!0).forEach((function(e){U(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function N(t){return function(t){if(Array.isArray(t))return Y(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Y(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function R(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function U(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const _=new(function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),U(this,"state",{allowDrawing:!1,localColor:"#000000",localLineWidth:5,localLineWidthUnscaled:5,localTool:0,currentDrawing:[],ownID:null,ownerID:null,maxRounds:0,roundEndTime:0,gestureId:0}),U(this,"handlers",[]),U(this,"_updating",!1),U(this,"clearDrawing",(function(){e.setState({currentDrawing:[],gestureId:0})})),U(this,"addPkt",(function(t){var n=e.state.currentDrawing;e.setState({currentDrawing:[].concat(N(n),[t])})})),U(this,"addFill",(function(t,n,o){var r=e.state.currentDrawing;e.setState({currentDrawing:[].concat(N(r),[{type:"fill",data:{x:t,y:n,color:o}}])})})),U(this,"addLine",(function(t,n,o,r,a,i){var c=e.state.currentDrawing;e.setState({currentDrawing:[].concat(N(c),[{type:"line",data:{gestureId:e.state.gestureId,fromX:t,fromY:n,toX:o,toY:r,color:a,lineWidth:i}}])})})),U(this,"incLineGesture",(function(){e.setState({gestureId:e.state.gestureId+1})})),U(this,"undoDrawing",(function(){var t=N(e.state.currentDrawing);t.splice(-1,1);var n=t[t.length-1];if(n&&"line"==n.type){var o=n.data.gestureId;t=t.filter((function(t){return"line"!=t.type||t.data.gestureId!=o}))}e.setState({currentDrawing:t})}))}var e,n;return e=t,(n=[{key:"setState",value:function(t){if(this._updating)console.error("cannot set state in state handlers");else{this._updating=!0;try{var e=F({},this.state);this.state=F(F({},this.state),t),console.log("prev state",e),console.log("next state",this.state),this._propagate(e)}catch(t){console.error(t)}this._updating=!1}}},{key:"_propagate",value:function(t){var e=this;this.handlers.map((function(n){return n(e.state,t)}))}},{key:"registerHandler",value:function(t){return this.handlers.push(t),function(){this.handlers.filter((function(e){return e!=t}))}}},{key:"reset",value:function(){var t=F({},this.state);this.state={},this.handlers=[],this._propagate(t)}}])&&R(e.prototype,n),t}());function J(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}const G=new(function(){function t(){var e,n,o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n={},(e="handlers")in this?Object.defineProperty(this,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[e]=n;var r="ws://"+location.hostname+":"+location.port+"/v1/ws?lobby_id="+window.lobbyId;this.socket=new ReconnectingWebSocket(r,null,{debug:!1,reconnectInterval:3e3,automaticOpen:!0}),this.socket.onmessage=function(t){var e=JSON.parse(t.data);void 0!==o.handlers[e.type]?o.handlers[e.type](e):console.error("socket received unknown message type "+e.type)},this.socket.onerror=function(t){return console.error("websocket error: ",t)}}var e,n;return e=t,(n=[{key:"open",value:function(){this.socket.open()}},{key:"addHandler",value:function(t,e){this.handlers[t]=e}},{key:"sendStart",value:function(){this.socket.send(JSON.stringify({type:"start"}))}},{key:"sendClear",value:function(){this.socket.send(JSON.stringify({type:"clear-drawing-board"}))}},{key:"sendMessage",value:function(t){this.socket.send(JSON.stringify({type:"message",data:t}))}},{key:"sendChooseWord",value:function(t){this.socket.send(JSON.stringify({type:"choose-word",data:t}))}},{key:"sendKickVote",value:function(t){this.socket.send(JSON.stringify({type:"kick-vote",data:t}))}},{key:"sendFill",value:function(t,e,n){this.socket.send(JSON.stringify({type:"fill",data:{x:t,y:e,color:n}}))}},{key:"sendLine",value:function(t,e,n,o,r,a,i){var c={type:"line",data:{fromX:t,fromY:e,toX:n,toY:o,color:r,lineWidth:a,gestureId:i}};this.socket.send(JSON.stringify(c))}},{key:"sendUndo",value:function(){this.socket.send(JSON.stringify({type:"undo"}))}}])&&J(e.prototype,n),t}());function V(t){return function(t){if(Array.isArray(t))return z(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return z(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var K=i.getContext("2d");function q(t){i.width=i.clientWidth,i.height=i.clientHeight,_.setState({localLineWidth:_.state.localLineWidthUnscaled*p()}),Z(),Q(_.state.currentDrawing)}function Q(t){Z(),t.forEach((function(t){var e=t.data;"fill"===t.type?tt.apply(void 0,V(h(e.x,e.y)).concat([e.color])):"line"===t.type?et.apply(void 0,V(h(e.fromX,e.fromY,e.toX,e.toY)).concat([e.color,h(e.lineWidth)[0]])):console.log("Unknown draw element type: "+e.type)}))}function Z(){K.fillStyle="#FFFFFF",K.fillRect(0,0,i.width,i.height)}function tt(t,e,n){K.fillStyle=n,K.fillFlood(t,e,1)}function et(t,e,n,o,r,a){t=Math.floor(t),e=Math.floor(e),n=Math.floor(n),o=Math.floor(o),a=Math.ceil(a),K.beginPath(),K.lineWidth=a,K.lineCap="round",K.strokeStyle=r,K.moveTo(t,e),K.lineTo(n,o),K.stroke()}q(),window.addEventListener("resize",q,!0);var nt=!1,ot=0,rt=0,at=0;function it(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function ct(t){var e=it(t);return"rgb("+e.r+","+e.g+","+e.b+")"}function lt(t){G.sendChooseWord(t),A(),$("#cc-toolbox").css({transform:"translateX(0)"}),$("#player-container").css({transform:"translateX(-150%)"}),_.setState({allowDrawing:!0})}function st(t){var e;void 0===t?e=b.value:(t=function(t){if(/^#[0-9A-F]{6}$/i.test(t))return t;function e(t){return("0"+parseInt(t).toString(16)).slice(-2)}return"#"+e((t=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))[1])+e(t[2])+e(t[3])}(t),b.value=t,e=t),_.setState({localColor:e})}function dt(t){_.setState({localLineWidthUnscaled:t,localLineWidth:t*p()})}function ut(t){0!==t&&1!==t&&2!==t||_.setState({localTool:t})}function ft(t,e,n,o){var r,a=_.state,i=a.localColor,c=a.localLineWidth;et(t,e,n,o,r=1===a.localTool?"#ffffff":i,c);var l=t*m(),s=e*m(),d=n*m(),u=o*m(),f=c*m();_.addLine(l,s,d,u,r,f),G.sendLine(l,s,d,u,r,f,_.state.gestureId)}function gt(t){var e=new Audio(t);e.type="audio/wav",e.play()}function yt(t){return function(t){if(Array.isArray(t))return mt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return mt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?mt(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}i.ontouchstart=function(t){_.incLineGesture();var e=_.state,n=e.allowDrawing,o=e.localTool;if(!nt&&n&&(at=t.touches[0].identifier,n&&2!==o)){var r=i.getBoundingClientRect();ot=t.touches[0].clientX-r.left,rt=t.touches[0].clientY-r.top,nt=!0}},i.ontouchmove=function(t){var e=_.state.allowDrawing;if(t.preventDefault(),e&&nt)for(var n=t.changedTouches.length-1;n>=0;n--)if(t.changedTouches[n].identifier===at){var o=t.changedTouches[n],r=i.getBoundingClientRect(),a=o.clientX-r.left,c=o.clientY-r.top;return ft(ot,rt,a,c),ot=a,void(rt=c)}},i.ontouchcancel=function(t){if(nt)for(var e=t.changedTouches.length-1;e>=0;e--)if(t.changedTouches[e].identifier===at)return void(nt=!1)},i.ontouchend=i.ontouchcancel,i.onmousedown=function(t){_.incLineGesture();var e=_.state,n=e.allowDrawing,o=e.localTool;return n&&0===t.button&&2!==o&&(ot=t.offsetX,rt=t.offsetY,nt=!0),!1},window.onmouseup=function(t){!0===nt&&(nt=!1)},i.onmousemove=function(t){if(_.state.allowDrawing&&!0===nt&&0===t.button){var e=i.getBoundingClientRect(),n=t.clientX-e.left,o=t.clientY-e.top;ft(ot,rt,n,o),ot=n,rt=o}},i.onmouseenter=function(t){ot=t.offsetX,rt=t.offsetY},i.onclick=function(t){var e=_.state,n=e.allowDrawing,o=e.localTool;n&&0===t.button&&(2===o?function(t,e){tt(t,e,_.state.localColor);var n=t*m(),o=e*m();_.addFill(n,o,_.state.localColor),G.sendFill(n,o,_.state.localColor)}(t.offsetX,t.offsetY):ft(t.offsetX,t.offsetY,t.offsetX,t.offsetY),nt=!1)},window.setInterval((function(){var t=Math.floor(_.state.roundEndTime-(new Date).getTime()/1e3);a.innerText=t>=0?t:"‚àû"}),500),G.addHandler("ready",(function(t){var e=t.data;_.setState({ownerID:e.ownerId,allowDrawing:e.drawing,ownID:e.playerId,maxRounds:e.maxRounds,roundEndTime:e.roundEndTime}),W(e.round,e.maxRounds),0===e.round&&(e.ownerId===e.playerId?H(c):H(l)),e.players&&L(e.players,_.state.ownID),e.currentDrawing&&e.currentDrawing.length&&Q(e.currentDrawing),e.wordHints&&e.wordHints.length&&X(e.wordHints)})),G.addHandler("update-players",(function(t){L(t.data,_.state.ownID)})),G.addHandler("correct-guess",(function(t){gt("/resources/plop.wav")})),G.addHandler("update-wordhint",(function(t){X(t.data)})),G.addHandler("message",(function(t){M(0,t.data.author,t.data.content)})),G.addHandler("system-message",(function(t){M(0,"System",t.data)})),G.addHandler("non-guessing-player-message",(function(t){M(0,t.data.author,t.data.content)})),G.addHandler("line",(function(t){t.data.gestureId>_.state.gestureId&&_.setState({gestureId:t.data.gestureId}),_.addPkt(t),et.apply(e,yt(h(t.data.fromX,t.data.fromY,t.data.toX,t.data.toY)).concat([t.data.color,h(t.data.lineWidth)[0]]))})),G.addHandler("fill",(function(t){_.addPkt(t),tt.apply(e,yt(h(t.data.x,t.data.y)).concat([t.data.color]))})),G.addHandler("clear-drawing-board",(function(t){_.setState({currentDrawing:[]}),Z()})),G.addHandler("undo",(function(t){_.undoDrawing(),Z(),Q(_.state.currentDrawing),tt.apply(e,yt(h(t.data.x,t.data.y)).concat([t.data.color]))})),G.addHandler("next-turn",(function(t){0===t.data.round?_.state.ownID===_.state.ownerID?H(c):H(l):A(),$("#cc-toolbox").css({transform:"translateX(-150%)"}),$("#player-container").css({transform:"translateX(0)"}),gt("/resources/end-turn.wav"),Z(),_.clearDrawing(),W(t.data.round,_.state.maxRounds),L(t.data.players,_.state.ownID),o.innerHTML="",_.setState({roundEndTime:t.data.roundEndTime,allowDrawing:!1})})),G.addHandler("your-turn",(function(t){dt(15),st("rgb(0,0,0)"),ut(0),j(0),x(0),gt("/resources/your-turn.wav"),t.data&&(u.textContent=t.data[0],f.textContent=t.data[1],g.textContent=t.data[2],0!==t.data.round&&H(d)),$("#cc-toolbox").css({transform:"translateX(0)"}),$("#player-container").css({transform:"translateX(-150%)"})})),s.onclick=function(t){return G.sendStart(),void H(startDialog)},u.onclick=function(t){return lt(0)},f.onclick=function(t){return lt(1)},g.onclick=function(t){return lt(2)},C.style.backgroundColor=_.state.localColor,T.style.backgroundColor=_.state.localColor,B.style.backgroundColor=_.state.localColor,C.onclick=function(t){dt(15),j(0)},T.onclick=function(t){dt(30),j(1)},B.onclick=function(t){dt(40),j(2)},_.registerHandler((function(t,e){var n=t.localLineWidth,o=t.localLineWidthUnscaled,r=t.localColor;if(r!=e.localColor||o!=e.localLineWidthUnscaled){var a,c,l="#FFFFFF";r.startsWith("#")?(a=ct(r),c=it(r),l=Math.sqrt(c.r*c.r*.299+c.g*c.g*.587+c.b*c.b*.114)>127.5?"rgb(0,0,0)":"rgb(255,255,255)"):a=r;var s=n;i.style.cursor='url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'.concat(s+2,'" height="').concat(s+2,'"><circle cx="').concat(s/2,'" cy="').concat(s/2,'" r="').concat(s/2,'" fill="').concat(a,'" stroke="').concat(l,"\"/></svg>') ").concat(s/2," ").concat(s/2,", auto")}})),b.onchange=function(t){return st(ct(t.target.value))},Array.from(document.getElementsByClassName("color-button")).forEach((function(t){t.onclick=function(t){return st(t.target.style.backgroundColor)}})),D.onclick=function(t){return ut(0)},E.onclick=function(t){return ut(2)},I.onclick=function(t){return ut(1)},S.onclick=function(t){return Z(),_.clearDrawing(),void G.sendClear()},O.onclick=function(t){0!=_.state.currentDrawing.length&&(_.undoDrawing(),G.sendUndo(),Q(_.state.currentDrawing))},_.registerHandler((function(t,e){var n=t.localTool;e.localTool!=n&&x(n)})),w.onsubmit=function(t){t.preventDefault(),G.sendMessage(v.value),v.value=""},c.style.display="none",l.style.display="none",G.open()})();
//# sourceMappingURL=game.js.map