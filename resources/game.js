(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{applyDrawData:()=>z,clear:()=>K,drawLine:()=>Z,fill:()=>Q});var n=document.getElementById("player-container"),r=document.getElementById("word-container"),o=document.getElementById("rounds"),a=document.getElementById("time-left"),i=document.getElementById("drawing-board"),c=document.getElementById("start-dialog"),l=document.getElementById("start-game-button"),s=document.getElementById("word-dialog"),d=document.getElementById("word-button-zero"),u=document.getElementById("word-button-one"),f=document.getElementById("word-button-two"),g=function(){return window.baseWidth/i.clientWidth},y=function(){return i.clientWidth/window.baseWidth},h=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.map((function(t){return t*y()}))},m=document.getElementById("message-container"),p=document.getElementById("message-input"),v=document.getElementById("message-form"),w=document.getElementById("color-picker"),b=(document.getElementById("center-dialog"),document.getElementById("chat"),document.getElementById("erase-tool")),k=document.getElementById("clear-tool"),I=document.getElementById("draw-tool"),S=document.getElementById("fill-tool"),D=document.getElementById("undo-tool"),E=document.getElementById("small-circle"),O=document.getElementById("medium-circle"),C=document.getElementById("huge-circle"),T=function(t){E.className=0==t?"active":"",O.className=1==t?"active":"",C.className=2==t?"active":""},j=function(t){I.className=0==t?"draw active":"draw",b.className=1==t?"erase active":"erase",S.className=2==t?"fill active":"fill"};function B(t,e){n.innerHTML="",t.forEach((function(t){if(t.connected){t.state;var r='<div class="playerBox"> <img src="../resources/image/avatar_phillip.png" alt=""><div class="name';r+='">'+t.name+"</div>",t.id!==e&&(r+='<button class="kick-button" id="kick-button" type="button" title="Vote to kick this player" alt="Vote to kick this player" onclick="onClickKickButton('+t.id+')">üëã</button>'),r+='<span class="score">'+t.score+"</span></div>",1===t.state?r+="<span>‚úèÔ∏è</span>":2===t.state&&(r+="<span>‚úîÔ∏è</span>"),r+="</div></div></div>";var o=document.createRange().createContextualFragment(r);console.log(o),n.appendChild(o)}}))}function H(t,e){o.innerText="Round "+t+" of "+e}function x(t){r.innerHTML="",t.forEach((function(t){if(0===t.character)r.innerHTML+='<span class="guess-letter guess-letter-underline">&nbsp;</span>';else{var e=String.fromCharCode(t.character);t.underline?r.innerHTML+='<span class="guess-letter guess-letter-underline">'+e+"</span>":r.innerHTML+='<span class="guess-letter">'+e+"</span>"}}))}function M(t,e,n){"Game over. Type !start again to start a new round."!==n?(m.childElementCount>=100&&m.removeChild(m.firstChild),m.innerHTML+='<div class="message '+t+'">\n                            <span class="chat-name">'+e+'</span>\n                            <span class="message-content">'+n+"</span>\n                        </div>"):show("#score-dialog")}function L(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function W(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?L(Object(n),!0).forEach((function(e){P(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function A(t){return function(t){if(Array.isArray(t))return X(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return X(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function F(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function P(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const N=new(function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),P(this,"state",{allowDrawing:!1,localColor:"#000000",localLineWidth:5,localLineWidthUnscaled:5,localTool:0,currentDrawing:[],ownID:null,ownerID:null,maxRounds:0,roundEndTime:0,gestureId:0}),P(this,"handlers",[]),P(this,"_updating",!1),P(this,"clearDrawing",(function(){e.setState({currentDrawing:[],gestureId:0})})),P(this,"addPkt",(function(t){var n=e.state.currentDrawing;e.setState({currentDrawing:[].concat(A(n),[t])})})),P(this,"addFill",(function(t,n,r){var o=e.state.currentDrawing;e.setState({currentDrawing:[].concat(A(o),[{type:"fill",data:{x:t,y:n,color:r}}])})})),P(this,"addLine",(function(t,n,r,o,a,i){var c=e.state.currentDrawing;e.setState({currentDrawing:[].concat(A(c),[{type:"line",data:{gestureId:e.state.gestureId,fromX:t,fromY:n,toX:r,toY:o,color:a,lineWidth:i}}])})})),P(this,"incLineGesture",(function(){e.setState({gestureId:e.state.gestureId+1})})),P(this,"undoDrawing",(function(){var t=A(e.state.currentDrawing);t.splice(-1,1);var n=t[t.length-1];if(n&&"line"==n.type){var r=n.data.gestureId;t=t.filter((function(t){return"line"!=t.type||t.data.gestureId!=r}))}e.setState({currentDrawing:t})}))}var e,n;return e=t,(n=[{key:"setState",value:function(t){if(this._updating)console.error("cannot set state in state handlers");else{this._updating=!0;try{var e=W({},this.state);this.state=W(W({},this.state),t),console.log("prev state",e),console.log("next state",this.state),this._propagate(e)}catch(t){console.error(t)}this._updating=!1}}},{key:"_propagate",value:function(t){var e=this;this.handlers.map((function(n){return n(e.state,t)}))}},{key:"registerHandler",value:function(t){return this.handlers.push(t),function(){this.handlers.filter((function(e){return e!=t}))}}},{key:"reset",value:function(){var t=W({},this.state);this.state={},this.handlers=[],this._propagate(t)}}])&&F(e.prototype,n),t}());function Y(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}const U=new(function(){function t(){var e,n,r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n={},(e="handlers")in this?Object.defineProperty(this,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[e]=n;var o="ws://"+location.hostname+":"+location.port+"/v1/ws?lobby_id="+window.lobbyId;this.socket=new ReconnectingWebSocket(o,null,{debug:!0,reconnectInterval:3e3,automaticOpen:!1}),this.socket.onmessage=function(t){var e=JSON.parse(t.data);void 0!==r.handlers[e.type]?r.handlers[e.type](e):console.error("socket received unknown message type "+e.type)},this.socket.onerror=function(t){return console.error("websocket error: ",t)}}var e,n;return e=t,(n=[{key:"open",value:function(){this.socket.open()}},{key:"addHandler",value:function(t,e){this.handlers[t]=e}},{key:"sendStart",value:function(){this.socket.send(JSON.stringify({type:"start"}))}},{key:"sendClear",value:function(){this.socket.send(JSON.stringify({type:"clear-drawing-board"}))}},{key:"sendMessage",value:function(t){this.socket.send(JSON.stringify({type:"message",data:t}))}},{key:"sendChooseWord",value:function(t){this.socket.send(JSON.stringify({type:"choose-word",data:t}))}},{key:"sendKickVote",value:function(t){this.socket.send(JSON.stringify({type:"kick-vote",data:t}))}},{key:"sendFill",value:function(t,e,n){this.socket.send(JSON.stringify({type:"fill",data:{x:t,y:e,color:n}}))}},{key:"sendLine",value:function(t,e,n,r,o,a){var i={type:"line",data:{fromX:t,fromY:e,toX:n,toY:r,color:o,lineWidth:a}};this.socket.send(JSON.stringify(i))}},{key:"sendUndo",value:function(){this.socket.send(JSON.stringify({type:"undo"}))}}])&&Y(e.prototype,n),t}());function R(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function J(t){var e=R(t);return"rgb("+e.r+","+e.g+","+e.b+")"}function _(t){return function(t){if(Array.isArray(t))return G(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return G(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?G(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function G(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var V=i.getContext("2d");function q(){i.width=i.clientWidth,i.height=i.clientHeight,N.setState({localLineWidthUnscaled:N.state.localLineWidthUnscaled,localLineWidth:N.state.localLineWidthUnscaled*y()})}function z(t){K(),t.forEach((function(t){var e=t.data;"fill"===t.type?Q.apply(void 0,_(h(e.x,e.y)).concat([e.color])):"line"===t.type?Z.apply(void 0,_(h(e.fromX,e.fromY,e.toX,e.toY)).concat([e.color,h(e.lineWidth)[0]])):console.log("Unknown draw element type: "+e.type)}))}function K(){V.fillStyle="#FFFFFF",V.fillRect(0,0,i.width,i.height)}function Q(t,e,n){V.fillStyle=n,V.fillFlood(t,e,1)}function Z(t,e,n,r,o,a){t=Math.floor(t),e=Math.floor(e),n=Math.floor(n),r=Math.floor(r),a=Math.ceil(a),o=R(o);for(var i=function(t){for(var e=[],n=0;n<2*t;n++){e[n]=[];for(var r=0;r<2*t;r++){var o=Math.sqrt(Math.pow(t-n,2)+Math.pow(t-r,2));e[n][r]=o>t?0:o<t-2?2:1}}return e}(Math.floor(a/2)),c=Math.floor(i.length/2),l=V.getImageData(0,0,V.canvas.clientWidth,V.canvas.clientHeight),s=0;s<i.length;s++)for(var d=0;d<i[s].length;d++)(1===i[s][d]||t===n&&e===r&&2===i[s][d])&&tt(l,t+s-c,e+d-c,n+s-c,r+d-c,o);V.putImageData(l,0,0)}function tt(t,e,n,r,o,a){for(var i=Math.abs(r-e),c=Math.abs(o-n),l=e<r?1:-1,s=n<o?1:-1,d=i-c;;){if(e<0||e>=t.width||n<0||n>=t.height)return;if(et(t,e,n,a),e===r&&n===o)break;var u=2*d;u>-c&&(d-=c,e+=l),u<i&&(d+=i,n+=s)}}function et(t,e,n,r){var o=4*(n*t.width+e);t.data[o]=r.r,t.data[o+1]=r.g,t.data[o+2]=r.b,t.data[o+3]=255}q(),window.addEventListener("resize",q,!1);var nt=!1,rt=0,ot=0,at=0;function it(t){U.sendChooseWord(t),hide("#word-dialog"),s.style.display="none",$("#cc-toolbox").css({transform:"translateX(0)"}),$("#player-container").css({transform:"translateX(-150%)"}),N.setState({allowDrawing:!0})}function ct(t){var e;void 0===t?e=w.value:(t=function(t){if(/^#[0-9A-F]{6}$/i.test(t))return t;function e(t){return("0"+parseInt(t).toString(16)).slice(-2)}return"#"+e((t=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))[1])+e(t[2])+e(t[3])}(t),w.value=t,e=t),N.setState({localColor:e})}function lt(t){N.setState({localLineWidthUnscaled:t,localLineWidth:t*y()})}function st(t){0!==t&&1!==t&&2!==t||N.setState({localTool:t})}function dt(t,e,n,r){var o,a=N.state,i=a.localColor,c=a.localLineWidth;Z(t,e,n,r,o=1===a.localTool?"#ffffff":i,c);var l=t*g(),s=e*g(),d=n*g(),u=r*g(),f=c*g();N.addLine(l,s,d,u,o,f),U.sendLine(l,s,d,u,o,f)}function ut(t){var e=new Audio(t);e.type="audio/wav",e.play()}function ft(t){return function(t){if(Array.isArray(t))return gt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return gt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?gt(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}i.ontouchstart=function(t){var e=N.state,n=e.allowDrawing,r=e.localTool;if(!nt&&n&&(at=t.touches[0].identifier,n&&2!==r)){var o=i.getBoundingClientRect();rt=t.touches[0].clientX-o.left,ot=t.touches[0].clientY-o.top,nt=!0}},i.ontouchmove=function(t){var e=N.state.allowDrawing;if(t.preventDefault(),e&&nt)for(var n=t.changedTouches.length-1;n>=0;n--)if(t.changedTouches[n].identifier===at){var r=t.changedTouches[n],o=i.getBoundingClientRect(),a=r.clientX-o.left,c=r.clientY-o.top;return dt(rt,ot,a,c),rt=a,void(ot=c)}},i.ontouchcancel=function(t){if(N.incLineGesture(),nt)for(var e=t.changedTouches.length-1;e>=0;e--)if(t.changedTouches[e].identifier===at)return void(nt=!1)},i.ontouchend=i.ontouchcancel,i.onmousedown=function(t){var e=N.state,n=e.allowDrawing,r=e.localTool;return n&&0===t.button&&2!==r&&(rt=t.offsetX,ot=t.offsetY,nt=!0),!1},window.onmouseup=function(t){!0===nt&&(nt=!1,N.incLineGesture())},i.onmousemove=function(t){if(N.state.allowDrawing&&!0===nt&&0===t.button){var e=i.getBoundingClientRect(),n=t.clientX-e.left,r=t.clientY-e.top;dt(rt,ot,n,r),rt=n,ot=r}},i.onmouseenter=function(t){rt=t.offsetX,ot=t.offsetY},i.onclick=function(t){var e=N.state,n=e.allowDrawing,r=e.localTool;n&&0===t.button&&(2===r?function(t,e){Q(t,e,N.state.localColor);var n=t*g(),r=e*g();N.addFill(n,r,N.state.localColor),U.sendFill(n,r,N.state.localColor)}(t.offsetX,t.offsetY):dt(t.offsetX,t.offsetY,t.offsetX,t.offsetY),nt=!1)},window.setInterval((function(){var t=Math.floor((N.state.roundEndTime-(new Date).getTime())/1e3);a.innerText=t>=0?t:"‚àû"}),500),U.addHandler("ready",(function(t){var e=t.data;N.setState({ownerID:e.ownerId,allowDrawing:e.drawing,ownID:e.playerId,maxRounds:e.maxRounds,roundEndTime:e.roundEndTime}),H(e.round,e.maxRounds),0===e.round&&e.ownerId===e.playerId&&(show("#start-dialog"),c.style.display="block"),e.players&&e.players.length&&B(e.players,N.state.ownID),e.currentDrawing&&e.currentDrawing.length&&z(e.currentDrawing),e.wordHints&&e.wordHints.length&&x(e.wordHints)})),U.addHandler("update-players",(function(t){B(t.data,N.state.ownID)})),U.addHandler("correct-guess",(function(t){ut("/resources/plop.wav")})),U.addHandler("update-wordhint",(function(t){x(t.data)})),U.addHandler("message",(function(t){M("",t.data.author,t.data.content)})),U.addHandler("system-message",(function(t){M("system-message","System",t.data)})),U.addHandler("non-guessing-player-message",(function(t){M("non-guessing-player-message",t.data.author,t.data.content)})),U.addHandler("persist-username",(function(t){document.cookie="username="+t.data+";expires=Tue, 19 Jan 2038 00:00:00 UTC;path=/;samesite=strict"})),U.addHandler("reset-username",(function(t){document.cookie="username=; expires=Thu, 01 Jan 1970 00:00:00 GMT"})),U.addHandler("line",(function(t){N.addPkt(t),Z.apply(e,ft(h(t.data.fromX,t.data.fromY,t.data.toX,t.data.toY)).concat([t.data.color,h(t.data.lineWidth)[0]]))})),U.addHandler("fill",(function(t){N.addPkt(t),Q.apply(e,ft(h(t.data.x,t.data.y)).concat([t.data.color]))})),U.addHandler("clear-drawing-board",(function(t){N.setState({currentDrawing:[]}),K()})),U.addHandler("undo",(function(t){N.undoDrawing(),K(),z(N.state.currentDrawing),Q.apply(e,ft(h(t.data.x,t.data.y)).concat([t.data.color]))})),U.addHandler("next-turn",(function(t){$("#cc-toolbox").css({transform:"translateX(-150%)"}),$("#player-container").css({transform:"translateX(0)"}),s.style.display="none",ut("/resources/end-turn.wav"),K(),N.clearDrawing(),H(t.data.round,N.state.maxRounds),B(t.data.players,N.state.ownID),r.innerHTML="",N.setState({roundEndTime:t.data.roundEndTime,allowDrawing:!1})})),U.addHandler("your-turn",(function(t){lt(15),ct("rgb(0,0,0)"),st(0),T(0),j(0),ut("/resources/your-turn.wav"),d.textContent=t.data[0],u.textContent=t.data[1],f.textContent=t.data[2],s.style.display="block",show("#word-dialog"),$("#cc-toolbox").css({transform:"translateX(0)"}),$("#player-container").css({transform:"translateX(-150%)"})})),l.onclick=function(t){return U.sendStart(),hide("#start-dialog"),show("#word-dialog"),void(s.style.display="block")},d.onclick=function(t){return it(0)},u.onclick=function(t){return it(1)},f.onclick=function(t){return it(2)},E.style.backgroundColor=N.state.localColor,O.style.backgroundColor=N.state.localColor,C.style.backgroundColor=N.state.localColor,E.onclick=function(t){lt(15),T(0)},O.onclick=function(t){lt(30),T(1)},C.onclick=function(t){lt(40),T(2)},N.registerHandler((function(t,e){var n=t.localLineWidth,r=t.localLineWidthUnscaled,o=t.localColor;if(o!=e.localColor||r!=e.localLineWidthUnscaled){var a,c,l="#FFFFFF";o.startsWith("#")?(a=J(o),c=R(o),l=Math.sqrt(c.r*c.r*.299+c.g*c.g*.587+c.b*c.b*.114)>127.5?"rgb(0,0,0)":"rgb(255,255,255)"):a=o;var s=n;i.style.cursor='url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'.concat(s+2,'" height="').concat(s+2,'"><circle cx="').concat(s/2,'" cy="').concat(s/2,'" r="').concat(s/2,'" fill="').concat(a,'" stroke="').concat(l,"\"/></svg>') ").concat(s/2," ").concat(s/2,", auto")}})),w.onchange=function(t){return ct(J(t.target.value))},Array.from(document.getElementsByClassName("color-button")).forEach((function(t){t.onclick=function(t){return ct(t.target.style.backgroundColor)}})),I.onclick=function(t){return st(0)},S.onclick=function(t){return st(2)},b.onclick=function(t){return st(1)},k.onclick=function(t){return K(),N.clearDrawing(),void U.sendClear()},D.onclick=function(t){0!=N.state.currentDrawing.length&&(N.undoDrawing(),U.sendUndo(),z(N.state.currentDrawing))},N.registerHandler((function(t,e){var n=t.localTool;e.localTool!=n&&j(n)})),v.onsubmit=function(t){t.preventDefault(),U.sendMessage(p.value),p.value=""},U.open()})();
//# sourceMappingURL=game.js.map