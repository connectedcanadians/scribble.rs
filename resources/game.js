(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function n(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function o(t){var e=Math.sqrt(t.r*t.r*.299+t.g*t.g*.587+t.b*t.b*.114);return borderColor=e>127.5?"rgb(0,0,0)":"rgb(255,255,255)",borderColor}t.r(e),t.d(e,{clear:()=>c,drawLine:()=>i,fill:()=>l,scaleDown:()=>g,scaleDownFactor:()=>f,scaleUpFactor:()=>u,setContext:()=>a});var r=null;function a(t){r=t}function c(){r.fillStyle="#FFFFFF",r.fillRect(0,0,drawingBoard.width,drawingBoard.height)}function l(t,e,n){r.fillStyle=n,r.fillFlood(t,e,1)}function i(t,e,o,a,c,l){t=Math.floor(t),e=Math.floor(e),o=Math.floor(o),a=Math.floor(a),l=Math.ceil(l),c=n(c);for(var i=function(t){var e=[];for(x=0;x<2*t;x++)for(e[x]=[],y=0;y<2*t;y++){var n=Math.sqrt(Math.pow(t-x,2)+Math.pow(t-y,2));e[x][y]=n>t?0:n<t-2?2:1}return e}(Math.floor(l/2)),d=Math.floor(i.length/2),u=r.getImageData(0,0,r.canvas.clientWidth,r.canvas.clientHeight),f=0;f<i.length;f++)for(var g=0;g<i[f].length;g++)(1===i[f][g]||t===o&&e===a&&2===i[f][g])&&s(u,t+f-d,e+g-d,o+f-d,a+g-d,c);r.putImageData(u,0,0)}function s(t,e,n,o,r,a){for(var c=Math.abs(o-e),l=Math.abs(r-n),i=e<o?1:-1,s=n<r?1:-1,u=c-l;;){if(e<0||e>=t.width||n<0||n>=t.height)return;if(d(t,e,n,a),e===o&&n===r)break;var f=2*u;f>-l&&(u-=l,e+=i),f<c&&(u+=c,n+=s)}}function d(t,e,n,o){var r=4*(n*t.width+e);t.data[r]=o.r,t.data[r+1]=o.g,t.data[r+2]=o.b,t.data[r+3]=255}var u=function(){return window.baseWidth/drawingBoard.clientWidth},f=function(){return drawingBoard.clientWidth/window.baseWidth},g=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.map((function(t){return t*f()}))};function h(t){var e=new Audio(t);e.type="audio/wav",e.play()}function m(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(Object(n),!0).forEach((function(e){v(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function w(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function v(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const b=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),v(this,"state",{allowDrawing:!1,localColor:"#000000",localLineWidth:0,localLineWidthUnscaled:0,localTool:0,ownID:null,ownerID:null,maxRounds:0,roundEndTime:0}),v(this,"handlers",[]),v(this,"_updating",!1)}var e,n;return e=t,(n=[{key:"setState",value:function(t){if(this._updating)console.error("cannot set state in state handlers");else{this._updating=!0;try{var e=p({},this.state);this.state=p(p({},this.state),t),console.log("prev state",e),console.log("next state",this.state),this._propagate(e)}catch(t){console.error(t)}this._updating=!1}}},{key:"_propagate",value:function(t){var e=this;this.handlers.map((function(n){return n(e.state,t)}))}},{key:"registerHandler",value:function(t){return this.handlers.push(t),function(){this.handlers.filter((function(e){return e!=t}))}}},{key:"reset",value:function(){var t=p({},this.state);this.state={},this.handlers=[],this._propagate(t)}}])&&w(e.prototype,n),t}());function k(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}const E=function(){function t(){var e,n,o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n={},(e="handlers")in this?Object.defineProperty(this,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[e]=n;var r="ws://"+location.hostname+":"+location.port+"/v1/ws?lobby_id="+window.lobbyId;this.socket=new ReconnectingWebSocket(r,null,{debug:!0,reconnectInterval:3e3,automaticOpen:!1}),this.socket.onmessage=function(t){var e=JSON.parse(t.data);void 0!==o.handlers[e.type]?o.handlers[e.type](e):console.error("socket received unknown message type "+e.type)},this.socket.onerror=function(t){return console.error("websocket error: ",t)}}var e,n;return e=t,(n=[{key:"open",value:function(){this.socket.open()}},{key:"addHandler",value:function(t,e){this.handlers[t]=e}},{key:"sendStart",value:function(){this.socket.send(JSON.stringify({type:"start"}))}},{key:"sendClear",value:function(){this.socket.send(JSON.stringify({type:"clear-drawing-board"}))}},{key:"sendMessage",value:function(t){this.socket.send(JSON.stringify({type:"message",data:t}))}},{key:"sendChooseWord",value:function(t){this.socket.send(JSON.stringify({type:"choose-word",data:t}))}},{key:"sendKickVote",value:function(t){this.socket.send(JSON.stringify({type:"kick-vote",data:t}))}},{key:"sendFill",value:function(t,e,n){this.socket.send(JSON.stringify({type:"fill",data:{x:t,y:e,color:n}}))}},{key:"sendLine",value:function(t,e,n,o,r,a){var c={type:"line",data:{fromX:t,fromY:e,toX:n,toY:o,color:r,lineWidth:a}};this.socket.send(JSON.stringify(c))}}])&&k(e.prototype,n),t}();function I(t){socket.sendChooseWord(t),hide("#word-dialog"),wordDialog.style.display="none",$("#cc-toolbox").css({transform:"translateX(0)"}),$("#player-container").css({transform:"translateX(-150%)"}),b.setState({allowDrawing:!0})}function B(t,n,o,r){var a,c=b.state,l=c.localColor,i=c.localLineWidth;a=c.localTool===RUBBER?"#ffffff":l,e.default.drawLine(t,n,o,r,a,i);var s=t*u(),d=n*u(),f=o*u(),g=r*u(),y=i*u();socket.sendLine(s,d,f,g,a,y)}function C(t){var e;void 0===t?e=colorPicker.value:(t=rgbStr2hex(t),colorPicker.value=t,e=t),b.setState({localColor:e})}function S(t){b.setState({localLineWidthUnscaled:t,localLineWidth:t*f()})}function O(t){t!==PEN&&t!==RUBBER&&t!==FILL_BUCKET||b.setState({localTool:t})}function T(t){return function(t){if(Array.isArray(t))return D(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return D(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}window.socket=new E;var H=document.getElementById("player-container"),M=document.getElementById("word-container"),F=document.getElementById("rounds"),j=document.getElementById("time-left"),L=document.getElementById("drawing-board"),W=document.getElementById("start-dialog"),X=document.getElementById("word-dialog"),P=document.getElementById("word-button-zero"),R=document.getElementById("word-button-one"),Y=document.getElementById("word-button-two");function _(){L.width=L.clientWidth,L.height=L.clientHeight,S(b.state.localLineWidthUnscaled)}function U(t){var e=b.state.ownID;H.innerHTML="",t.forEach((function(t){if(t.connected){t.state;var n='<div class="playerBox"> <img src="../resources/image/avatar_phillip.png" alt=""><div class="name';n+='">'+t.name+"</div>",t.id!==e&&(n+='<button class="kick-button" id="kick-button" type="button" title="Vote to kick this player" alt="Vote to kick this player" onclick="onClickKickButton('+t.id+')">üëã</button>'),n+='<span class="score">'+t.score+'</span><span class="last-turn-score">(Last turn: '+t.lastScore+")</span></div>",1===t.state?n+="<span>‚úèÔ∏è</span>":2===t.state&&(n+="<span>‚úîÔ∏è</span>"),n+="</div></div></div>";var o=document.createRange().createContextualFragment(n);console.log(o),H.appendChild(o)}}))}function A(t,e){F.innerText="Round "+t+" of "+e}function J(t){M.innerHTML="",t.forEach((function(t){if(0===t.character)M.innerHTML+='<span class="guess-letter guess-letter-underline">&nbsp;</span>';else{var e=String.fromCharCode(t.character);t.underline?M.innerHTML+='<span class="guess-letter guess-letter-underline">'+e+"</span>":M.innerHTML+='<span class="guess-letter">'+e+"</span>"}}))}a(L.getContext("2d")),b.registerHandler((function(t,e){var r=t.localLineWidth,a=t.localColor;if(r!=e.localLineWidth||a!=e.localColor){var c,l,i="#FFFFFF";a.startsWith("#")?(c="rgb("+(l=n(a)).r+","+l.g+","+l.b+")",i=o(n(a))):c=a,console.log(c,i);var s=r*u();document.getElementById("draw-tool").style.backgroundColor=c,document.getElementById("fill-tool").style.backgroundColor=c,L.style.cursor='url(\'data:image/svg+xml;utf8,\n            <svg \n                xmlns="http://www.w3.org/2000/svg" \n                version="1.1" \n                width="'.concat(s+2,'"\n                height="').concat(s+2,'">\n                    <circle \n                        cx="').concat(s/2,'" \n                        cy="').concat(s/2,'" \n                        r="').concat(s/2,'" \n                        fill="').concat(c,'" \n                        stroke="').concat(i,"\"\n                        />\n            </svg>\n        ') ").concat(s/2," ").concat(s/2,", auto")}})),socket.addHandler("ready",(function(t){var n,o=t.data;b.setState({ownerID:o.ownerId,allowDrawing:o.drawing,ownID:o.playerId,maxRounds:o.maxRounds,roundEndTime:o.roundEndTime}),A(o.round,o.maxRounds),0===o.round&&o.ownerId===o.playerId&&(show("#start-dialog"),W.style.display="block"),o.players&&o.players.length&&U(o.players),o.currentDrawing&&o.currentDrawing.length&&(n=o.currentDrawing,c(),n.forEach((function(t){var n=t.data;"fill"===t.type?l.apply(e,T(g(n.x,n.y)).concat([n.color])):"line"===t.type?i.apply(e,T(g(n.fromX,n.fromY,n.toX,n.toY)).concat([n.color,g(n.lineWidth)[0]])):console.log("Unknown draw element type: "+n.type)}))),o.wordHints&&o.wordHints.length&&J(o.wordHints)})),socket.addHandler("update-players",(function(t){U(t.data)})),socket.addHandler("correct-guess",(function(t){h("/resources/plop.wav")})),socket.addHandler("update-wordhint",(function(t){J(t.data)})),socket.addHandler("message",(function(t){applyMessage("",t.data.author,t.data.content)})),socket.addHandler("system-message",(function(t){applyMessage("system-message","System",t.data)})),socket.addHandler("non-guessing-player-message",(function(t){applyMessage("non-guessing-player-message",t.data.author,t.data.content)})),socket.addHandler("persist-username",(function(t){document.cookie="username="+t.data+";expires=Tue, 19 Jan 2038 00:00:00 UTC;path=/;samesite=strict"})),socket.addHandler("reset-username",(function(t){document.cookie="username=; expires=Thu, 01 Jan 1970 00:00:00 GMT"})),socket.addHandler("line",(function(t){i.apply(e,T(g(t.data.fromX,t.data.fromY,t.data.toX,t.data.toY)).concat([t.data.color,g(t.data.lineWidth)[0]]))})),socket.addHandler("fill",(function(t){l.apply(e,T(g(t.data.x,t.data.y)).concat([t.data.color]))})),socket.addHandler("clear-drawing-board",(function(t){c()})),socket.addHandler("next-turn",(function(t){$("#cc-toolbox").css({transform:"translateX(-150%)"}),$("#player-container").css({transform:"translateX(0)"}),X.style.display="none",h("/resources/end-turn.wav"),c(),A(t.data.round,b.state.maxRounds),U(t.data.players),M.innerHTML="",b.setState({roundEndTime:t.data.roundEndTime,allowDrawing:!1})})),socket.addHandler("your-turn",(function(t){h("/resources/your-turn.wav"),P.textContent=t.data[0],R.textContent=t.data[1],Y.textContent=t.data[2],X.style.display="block",show("#word-dialog"),$("#cc-toolbox").css({transform:"translateX(0)"}),$("#player-container").css({transform:"translateX(-150%)"})})),window.setInterval((function(){var t=Math.floor((b.state.roundEndTime-(new Date).getTime())/1e3);j.innerText=t>=0?t:"‚àû"}),500);var N=!1,z=0,K=0,V=0;L.ontouchstart=function(t){var e=b.state,n=e.allowDrawing,o=e.localTool;if(!N&&n&&(V=t.touches[0].identifier,n&&2!==o)){var r=L.getBoundingClientRect();z=t.touches[0].clientX-r.left,K=t.touches[0].clientY-r.top,N=!0}},L.ontouchmove=function(t){var e=b.state.allowDrawing;if(t.preventDefault(),e&&N)for(var n=t.changedTouches.length-1;n>=0;n--)if(t.changedTouches[n].identifier===V){var o=t.changedTouches[n],r=L.getBoundingClientRect(),a=o.clientX-r.left,c=o.clientY-r.top;return B(z,K,a,c),z=a,void(K=c)}},L.ontouchcancel=function(t){if(N)for(var e=t.changedTouches.length-1;e>=0;e--)if(t.changedTouches[e].identifier===V)return void(N=!1)},L.ontouchend=L.ontouchcancel,L.onmousedown=function(t){var e=b.state,n=e.allowDrawing,o=e.localTool;return n&&0===t.button&&2!==o&&(z=t.offsetX,K=t.offsetY,N=!0),!1},window.onmouseup=function(t){!0===N&&(N=!1)},L.onmousemove=function(t){if(b.state.allowDrawing&&!0===N&&0===t.button){var e=L.getBoundingClientRect(),n=t.clientX-e.left,o=t.clientY-e.top;B(z,K,n,o),z=n,K=o}},L.onmouseenter=function(t){z=t.offsetX,K=t.offsetY},L.onclick=function(t){var n=b.state,o=n.allowDrawing,r=n.localTool;o&&0===t.button&&(2===r?function(t,n){e.default.fill(t,n,b.state.localColor);var o=t*u(),r=n*u();socket.sendFill(o,r,b.state.localColor)}(t.offsetX,t.offsetY):B(t.offsetX,t.offsetY,t.offsetX,t.offsetY),N=!1)},_(),window.addEventListener("resize",_,!1),document.getElementById("start-game-button").onclick=function(t){return socket.sendStart(),hide("#start-dialog"),show("#word-dialog"),void(X.style.display="block")},document.getElementById("word-button-zero").onclick=function(t){return I(0)},document.getElementById("word-button-one").onclick=function(t){return I(1)},document.getElementById("word-button-two").onclick=function(t){return I(2)},document.getElementById("draw-tool").onclick=function(t){return O(0)},document.getElementById("fill-tool").onclick=function(t){return O(2)},document.getElementById("erase-tool").onclick=function(t){return O(1)},document.getElementById("clear-tool").onclick=function(t){return e.default.clear(),void socket.sendClear()},document.getElementById("color-picker").onchange=C,document.getElementById("message-form").onsubmit=function(t){t.preventDefault(),sendMessage()},Array.from(document.getElementsByClassName("color-button")).forEach((function(t){t.onclick=function(t){return C(t.target.style.backgroundColor)}})),document.getElementById("small-circle").style.backgroundColor=cursorColor,document.getElementById("medium-circle").style.backgroundColor=cursorColor,document.getElementById("huge-circle").style.backgroundColor=cursorColor,document.getElementById("small-circle").onclick=function(t){return S(15)},document.getElementById("medium-circle").onclick=function(t){return S(30)},document.getElementById("huge-circle").onclick=function(t){return S(40)},gameState.registerHandler((function(t,e){var n=t.localLineWidth,o=t.localColor;if(o!=e.localColor){var r,a="#FFFFFF";o.startsWith("#")?(r=hexToRgbStr(o),a=contrastShade(hexToRgb(o))):r=o,console.log(r,a);var c=n*canvas.scaleUpFactor();document.getElementById("draw-tool").style.backgroundColor=r,document.getElementById("fill-tool").style.backgroundColor=r,drawingBoard.style.cursor='url(\'data:image/svg+xml;utf8,\n            <svg \n                xmlns="http://www.w3.org/2000/svg" \n                version="1.1" \n                width="'.concat(c+2,'"\n                height="').concat(c+2,'">\n                    <circle \n                        cx="').concat(c/2,'" \n                        cy="').concat(c/2,'" \n                        r="').concat(c/2,'" \n                        fill="').concat(r,'" \n                        stroke="').concat(a,"\"\n                        />\n            </svg>\n        ') ").concat(c/2," ").concat(c/2,", auto")}})),S(5),socket.open()})();
//# sourceMappingURL=game.js.map